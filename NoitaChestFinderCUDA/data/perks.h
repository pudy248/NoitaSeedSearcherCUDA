#pragma once

#include "cuda_runtime.h"
#include "device_launch_parameters.h"
#include "../misc/datatypes.h"

struct PerkData
{
	bool stackable;
	bool stackable_rare;
	byte stackable_max;
	byte max_in_pool;
	bool not_default;
	byte stackable_how_often_reappears;
};

#define perkCount 106
__device__ const PerkData perkAttrs[] =
{
	{true}, //CRITICAL_HIT
	{true, true}, //BREATH_UNDERWATER
	{true}, //EXTRA_MONEY
	{true}, //EXTRA_MONEY_TRICK_KILL
	{}, //GOLD_IS_FOREVER
	{}, //TRICK_BLOOD_MONEY
	{true, true, 6, 1}, //EXPLODING_GOLD
	{true, false, 0, 1}, //HOVER_BOOST
	{true, false, 0, 1}, //FASTER_LEVITATION
	{true, false, 0, 2}, //MOVEMENT_FASTER
	{true, false, 0, 1}, //STRONG_KICK
	{}, //TELEKINESIS
	{true, true, 8, 2}, //REPELLING_CAPE
	{}, //EXPLODING_CORPSES
	{}, //SAVING_GRACE
	{}, //INVISIBILITY
	{true, false, 0, 1}, //GLOBAL_GORE
	{}, //REMOVE_FOG_OF_WAR
	{true, true, 0, 2}, //LEVITATION_TRAIL
	{}, //VAMPIRISM
	{true, false, 0, 3}, //EXTRA_HP
	{true, true, 9, 2}, //HEARTS_MORE_EXTRA_HP
	{true, true, 2, 2}, //GLASS_CANNON
	{true, true, 0, 2}, //LOW_HP_DAMAGE_BOOST
	{true, true}, //RESPAWN
	{true, true}, //WORM_ATTRACTOR
	{}, //RADAR_ENEMY
	{}, //FOOD_CLOCK
	{}, //IRON STOMACH
	{}, //WAND_RADAR
	{}, //ITEM_RADAR
	{false, false, 0, 0, true}, //MOON_RADAR
	{false, false, 0, 0, true}, //MAP
	{}, //PROTECTION_FIRE
	{}, //PROTECTION_RADIOACTIVITY
	{}, //PROTECTION_EXPLOSION
	{}, //PROTECTION_MELEE
	{}, //PROTECTION_ELECTRICITY
	{}, //TELEPORTITIS
	{}, //TELEPORTITIS_DODGE
	{true, true}, //STAINLESS_ARMOUR
	{}, //EDIT_WANDS_EVERYWHERE
	{}, //NO_WAND_EDITING
	{true, true}, //WAND_EXPERIMENTER
	{}, //ADVENTURER
	{}, //ABILITY_ACTIONS_MATERIALIZED
	{}, //PROJECTILE_HOMING
	{}, //PROJECTILE_HOMING_SHOOTER
	{}, //UNLIMITED_SPELLS
	{}, //FREEZE_FIELD
	{}, //FIRE_GAS
	{}, //DISSOLVE_POWDERS
	{true, true}, //BLEED_SLIME
	{}, //BLEED_OIL
	{}, //BLEED_GAS
	{true, false, 5, 2, false, 10}, //SHIELD
	{true, true}, //REVENGE_EXPLOSION
	{true, true}, //REVENGE_TENTACLE
	{}, //REVENGE_RATS
	{true, true}, //REVENGE_BULLET
	{true, true, 3, 2}, //ATTACK_FOOT
	{true, true, 0, 0, true}, //LEGGY_FEET
	{true, true, 5, 2}, //PLAGUE_RATS
	{}, //VOMIT_RATS
	{}, //CORDYCEPS
	{}, //MOLD
	{}, //WORM_SMALLER_HOLES
	{true, true}, //PROJECTILE_REPULSION
	{true, true, 3, 2}, //RISKY_CRITICAL
	{true, true, 3, 2}, //FUNGAL_DISEASE
	{true, true}, //PROJECTILE_SLOW_FIELD
	{true, true}, //PROJECTILE_REPULSION_SECTOR
	{}, //PROJECTILE_EATER_SECTOR
	{true, false, 0, 2, false, 10}, //ORBIT
	{true}, //ANGRY_GHOST
	{true, false, 5, 2}, //HUNGRY_GHOST
	{true, true}, //DEATH_GHOST
	{true, false, 10, 2}, //HOMUNCULUS
	{}, //LUKKI_MINION
	{}, //ELECTRICITY
	{true, false, 6, 1}, //ATTRACT_ITEMS
	{true, true}, //EXTRA_KNOCKBACK
	{true, true}, //LOWER_SPREAD
	{}, //LOW_RECOIL
	{}, //BOUNCE
	{}, //FAST_PROJECTILES
	{true}, //ALWAYS_CAST
	{true}, //EXTRA_MANA
	{}, //NO_MORE_SHUFFLE
	{}, //NO_MORE_KNOCKBACK
	{true}, //DUPLICATE_PROJECTILE
	{true}, //FASTER_WANDS
	{true}, //EXTRA_SLOTS
	{}, //CONTACT_DAMAGE
	{true, false, 5, 3}, //EXTRA_PERK
	{true, true, 6, 3}, //PERKS_LOTTERY
	{true}, //GAMBLE
	{true, false, 5, 2}, //EXTRA_SHOP_ITEM
	{true}, //GENOME_MORE_HATRED
	{true}, //GENOME_MORE_LOVE
	{}, //PEACE_WITH_GODS
	{}, //MANA_FROM_KILLS
	{}, //ANGRY_LEVITATION
	{true, true}, //LASER_AIM
	{true, true, 5, 2}, //PERSONAL_LASER
	{true} //MEGA_BEAM_STONE
};

__device__ const char* perkNames[] =
{
	"CRITICAL_HIT",
	"BREATH_UNDERWATER",
	"EXTRA_MONEY",
	"EXTRA_MONEY_TRICK_KILL",
	"GOLD_IS_FOREVER",
	"TRICK_BLOOD_MONEY",
	"EXPLODING_GOLD",
	"HOVER_BOOST",
	"FASTER_LEVITATION",
	"MOVEMENT_FASTER",
	"STRONG_KICK",
	"TELEKINESIS",
	"REPELLING_CAPE",
	"EXPLODING_CORPSES",
	"SAVING_GRACE",
	"INVISIBILITY",
	"GLOBAL_GORE",
	"REMOVE_FOG_OF_WAR",
	"LEVITATION_TRAIL",
	"VAMPIRISM",
	"EXTRA_HP",
	"HEARTS_MORE_EXTRA_HP",
	"GLASS_CANNON",
	"LOW_HP_DAMAGE_BOOST",
	"RESPAWN",
	"WORM_ATTRACTOR",
	"RADAR_ENEMY",
	"FOOD_CLOCK",
	"IRON STOMACH",
	"WAND_RADAR",
	"ITEM_RADAR",
	"MOON_RADAR",
	"MAP",
	"PROTECTION_FIRE",
	"PROTECTION_RADIOACTIVITY",
	"PROTECTION_EXPLOSION",
	"PROTECTION_MELEE",
	"PROTECTION_ELECTRICITY",
	"TELEPORTITIS",
	"TELEPORTITIS_DODGE",
	"STAINLESS_ARMOUR",
	"EDIT_WANDS_EVERYWHERE",
	"NO_WAND_EDITING",
	"WAND_EXPERIMENTER",
	"ADVENTURER",
	"ABILITY_ACTIONS_MATERIALIZED",
	"PROJECTILE_HOMING",
	"PROJECTILE_HOMING_SHOOTER",
	"UNLIMITED_SPELLS",
	"FREEZE_FIELD",
	"FIRE_GAS",
	"DISSOLVE_POWDERS",
	"BLEED_SLIME",
	"BLEED_OIL",
	"BLEED_GAS",
	"SHIELD",
	"REVENGE_EXPLOSION",
	"REVENGE_TENTACLE",
	"REVENGE_RATS",
	"REVENGE_BULLET",
	"ATTACK_FOOT",
	"LEGGY_FEET",
	"PLAGUE_RATS",
	"VOMIT_RATS",
	"CORDYCEPS",
	"MOLD",
	"WORM_SMALLER_HOLES",
	"PROJECTILE_REPULSION",
	"RISKY_CRITICAL",
	"FUNGAL_DISEASE",
	"PROJECTILE_SLOW_FIELD",
	"PROJECTILE_REPULSION_SECTOR",
	"PROJECTILE_EATER_SECTOR",
	"ORBIT",
	"ANGRY_GHOST",
	"HUNGRY_GHOST",
	"DEATH_GHOST",
	"HOMUNCULUS",
	"LUKKI_MINION",
	"ELECTRICITY",
	"ATTRACT_ITEMS",
	"EXTRA_KNOCKBACK",
	"LOWER_SPREAD",
	"LOW_RECOIL",
	"BOUNCE",
	"FAST_PROJECTILES",
	"ALWAYS_CAST",
	"EXTRA_MANA",
	"NO_MORE_SHUFFLE",
	"NO_MORE_KNOCKBACK",
	"DUPLICATE_PROJECTILE",
	"FASTER_WANDS",
	"EXTRA_SLOTS",
	"CONTACT_DAMAGE",
	"EXTRA_PERK",
	"PERKS_LOTTERY",
	"GAMBLE",
	"EXTRA_SHOP_ITEM",
	"GENOME_MORE_HATRED",
	"GENOME_MORE_LOVE",
	"PEACE_WITH_GODS",
	"MANA_FROM_KILLS",
	"ANGRY_LEVITATION",
	"LASER_AIM",
	"PERSONAL_LASER",
	"MEGA_BEAM_STONE",
};

enum Perk : byte {
	PERK_NONE,
	PERK_CRITICAL_HIT,
	PERK_BREATH_UNDERWATER,
	PERK_EXTRA_MONEY,
	PERK_EXTRA_MONEY_TRICK_KILL,
	PERK_GOLD_IS_FOREVER,
	PERK_TRICK_BLOOD_MONEY,
	PERK_EXPLODING_GOLD,
	PERK_HOVER_BOOST,
	PERK_FASTER_LEVITATION,
	PERK_MOVEMENT_FASTER,
	PERK_STRONG_KICK,
	PERK_TELEKINESIS,
	PERK_REPELLING_CAPE,
	PERK_EXPLODING_CORPSES,
	PERK_SAVING_GRACE,
	PERK_INVISIBILITY,
	PERK_GLOBAL_GORE,
	PERK_REMOVE_FOG_OF_WAR,
	PERK_LEVITATION_TRAIL,
	PERK_VAMPIRISM,
	PERK_EXTRA_HP,
	PERK_HEARTS_MORE_EXTRA_HP,
	PERK_GLASS_CANNON,
	PERK_LOW_HP_DAMAGE_BOOST,
	PERK_RESPAWN,
	PERK_WORM_ATTRACTOR,
	PERK_RADAR_ENEMY,
	PERK_FOOD_CLOCK,
	PERK_IRON_STOMACH,
	PERK_WAND_RADAR,
	PERK_ITEM_RADAR,
	PERK_MOON_RADAR,
	PERK_MAP,
	PERK_PROTECTION_FIRE,
	PERK_PROTECTION_RADIOACTIVITY,
	PERK_PROTECTION_EXPLOSION,
	PERK_PROTECTION_MELEE,
	PERK_PROTECTION_ELECTRICITY,
	PERK_TELEPORTITIS,
	PERK_TELEPORTITIS_DODGE,
	PERK_STAINLESS_ARMOUR,
	PERK_EDIT_WANDS_EVERYWHERE,
	PERK_NO_WAND_EDITING,
	PERK_WAND_EXPERIMENTER,
	PERK_ADVENTURER,
	PERK_ABILITY_ACTIONS_MATERIALIZED,
	PERK_PROJECTILE_HOMING,
	PERK_PROJECTILE_HOMING_SHOOTER,
	PERK_UNLIMITED_SPELLS,
	PERK_FREEZE_FIELD,
	PERK_FIRE_GAS,
	PERK_DISSOLVE_POWDERS,
	PERK_BLEED_SLIME,
	PERK_BLEED_OIL,
	PERK_BLEED_GAS,
	PERK_SHIELD,
	PERK_REVENGE_EXPLOSION,
	PERK_REVENGE_TENTACLE,
	PERK_REVENGE_RATS,
	PERK_REVENGE_BULLET,
	PERK_ATTACK_FOOT,
	PERK_LEGGY_FEET,
	PERK_PLAGUE_RATS,
	PERK_VOMIT_RATS,
	PERK_CORDYCEPS,
	PERK_MOLD,
	PERK_WORM_SMALLER_HOLES,
	PERK_PROJECTILE_REPULSION,
	PERK_RISKY_CRITICAL,
	PERK_FUNGAL_DISEASE,
	PERK_PROJECTILE_SLOW_FIELD,
	PERK_PROJECTILE_REPULSION_SECTOR,
	PERK_PROJECTILE_EATER_SECTOR,
	PERK_ORBIT,
	PERK_ANGRY_GHOST,
	PERK_HUNGRY_GHOST,
	PERK_DEATH_GHOST,
	PERK_HOMUNCULUS,
	PERK_LUKKI_MINION,
	PERK_ELECTRICITY,
	PERK_ATTRACT_ITEMS,
	PERK_EXTRA_KNOCKBACK,
	PERK_LOWER_SPREAD,
	PERK_LOW_RECOIL,
	PERK_BOUNCE,
	PERK_FAST_PROJECTILES,
	PERK_ALWAYS_CAST,
	PERK_EXTRA_MANA,
	PERK_NO_MORE_SHUFFLE,
	PERK_NO_MORE_KNOCKBACK,
	PERK_DUPLICATE_PROJECTILE,
	PERK_FASTER_WANDS,
	PERK_EXTRA_SLOTS,
	PERK_CONTACT_DAMAGE,
	PERK_EXTRA_PERK,
	PERK_PERKS_LOTTERY,
	PERK_GAMBLE,
	PERK_EXTRA_SHOP_ITEM,
	PERK_GENOME_MORE_HATRED,
	PERK_GENOME_MORE_LOVE,
	PERK_PEACE_WITH_GODS,
	PERK_MANA_FROM_KILLS,
	PERK_ANGRY_LEVITATION,
	PERK_LASER_AIM,
	PERK_PERSONAL_LASER,
	PERK_MEGA_BEAM_STONE,
};

__device__ const signed char perkStackableDistances[] = {
	4,
	4,
	4,
	4,
	-1,
	-1,
	4,
	4,
	4,
	4,
	4,
	-1,
	4,
	-1,
	-1,
	-1,
	4,
	-1,
	4,
	-1,
	4,
	4,
	4,
	4,
	4,
	4,
	-1,
	-1,
	-1,
	-1,
	-1,
	-1,
	-1,
	-1,
	-1,
	-1,
	-1,
	-1,
	-1,
	-1,
	4,
	-1,
	-1,
	4,
	-1,
	-1,
	-1,
	-1,
	-1,
	-1,
	-1,
	-1,
	4,
	-1,
	-1,
	10,
	4,
	4,
	-1,
	4,
	4,
	-1,
	4,
	-1,
	-1,
	-1,
	-1,
	4,
	4,
	4,
	4,
	4,
	-1,
	10,
	4,
	4,
	4,
	4,
	-1,
	-1,
	4,
	4,
	4,
	-1,
	-1,
	-1,
	4,
	4,
	-1,
	-1,
	4,
	4,
	4,
	-1,
	4,
	4,
	4,
	4,
	4,
	4,
	-1,
	-1,
	-1,
	4,
	4,
	4
};

__device__ void shuffle_table(byte* perk_deck, NollaPRNG* rng, int iters) {
	for (int i = iters; i > 0; i--) {
		int j = rng->Random(0, i);
		sbyte tmp = perk_deck[i];
		perk_deck[i] = perk_deck[j];
		perk_deck[j] = tmp;
	}
}

struct PerkInfo
{
	Perk p;
	bool lottery;
	int minPosition;
	int maxPosition;
};